{"componentChunkName":"component---src-templates-blog-template-js","path":"/web-dev-2/","result":{"data":{"cur":{"id":"0f74b1ac-d800-54f2-bfbd-9c628def8f9e","html":"<h1 id=\"firebase-doc-정리해보기\" style=\"position:relative;\"><a href=\"#firebase-doc-%EC%A0%95%EB%A6%AC%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"firebase doc 정리해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Firebase Doc 정리해보기</h1>\n<br />\n<p>기본적으로 소규모 스타트업에서 벡엔드를 직접 구축한다면 서버 인프라 관리부터 서버단/클라이언트 개발을 모두 신경써야 합니다.\r\n소규모 인원으로 프로젝트를 진행한다면 사용자 피드백을 받아들이기 매우 버겁죠.</p>\n<p>하지만 Firebase를 이용한다면 Database, Storage, Auth, Analytics까지 제공해주기 때문에 벡엔드에 대한 큰 고민 없이 서비스를 제작할 수 있습니다.</p>\n<br />\n<hr>\n<br />\n<h2 id=\"1-firebase-연동\" style=\"position:relative;\"><a href=\"#1-firebase-%EC%97%B0%EB%8F%99\" aria-label=\"1 firebase 연동 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Firebase 연동</h2>\n<p>연동을 위해서는 <a href=\"https://firebase.google.com/\">Firebase 홈페이지</a>에서 SDK를 통해 연동을 해주어야 합니다.</p>\n<p>프로젝트 만들기를 통해 firebase 프로젝트를 만들어 주세요.</p>\n<p>그리고 프로젝트 설정에서 <strong>웹앱 만들기</strong>로 들어가 주어지는 코드를 루트 폴더의 <strong>firebase.ts</strong>에 입력해 줍니다.</p>\n<p>이제 원하는 프로젝트의 빌드 제품을 사용하기 위해서 일련의 설정을 해야합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token operator\">!</span><span class=\"token function\">getApps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token operator\">?</span> <span class=\"token function\">initializeApp</span><span class=\"token punctuation\">(</span>firebaseConfig<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token function\">getApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>우선 firebase.ts의 가장 아래쪽을 위 문장으로 수정해줍니다.</p>\n<p>이는 앱이 구성되어 있지 않으면 새롭게 생성하고, 이미 생성되있다면 그대로 사용하는 코드입니다.</p>\n<br />\n<ul>\n<li><span style=\"color:#005b96\">Firebase Database CRUD</span></li>\n</ul>\n<p>const db = getFirestore(app);</p>\n<ul>\n<li><span style=\"color:#BF3100\">Firebase Storage</span></li>\n</ul>\n<p>const storage = getStorage();</p>\n<br />\n<p>그후, <strong>Firestore</strong>를 위한 제품과 <strong>storage</strong>를 위한 제품을 추가해줍니다.</p>\n<br />\n<hr>\n<br />\n<h2 id=\"2-cloud-firestore-기본-사용법\" style=\"position:relative;\"><a href=\"#2-cloud-firestore-%EA%B8%B0%EB%B3%B8-%EC%82%AC%EC%9A%A9%EB%B2%95\" aria-label=\"2 cloud firestore 기본 사용법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Cloud Firestore 기본 사용법</h2>\n<br />\n<p>NoSQL 기반인 Cloud Firestore로 SQL데이터베이스와는 달리 테이블이나 행이 없습니다. 대신 컬렉션(Collection)으로 구성된 문서(doc)에 데이터를 저장합니다.</p>\n<p>Cloud Firebase의 모든 문서는 데이터베이스 내 위치가 고유합니다.\r\n이말은 해당 위치에 대한 참조를 넣어야 사용할 수 있다는 것이죠.</p>\n<br />\n<h3 id=\"doc문서-참조\" style=\"position:relative;\"><a href=\"#doc%EB%AC%B8%EC%84%9C-%EC%B0%B8%EC%A1%B0\" aria-label=\"doc문서 참조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Doc(문서) 참조</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> doc <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> alovelaceDocumentRef <span class=\"token operator\">=</span> <span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">'users'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'alovelace'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<blockquote>\n<blockquote>\n<p>doc(firebase.ts에서 export한 db, ‘컬렉션 이름’, ‘doc 이름’)</p>\n</blockquote>\n</blockquote>\n<br />\n<h3 id=\"collection컬렉션-참조\" style=\"position:relative;\"><a href=\"#collection%EC%BB%AC%EB%A0%89%EC%85%98-%EC%B0%B8%EC%A1%B0\" aria-label=\"collection컬렉션 참조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Collection(컬렉션) 참조</h3>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> collection <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> usersCollectionRef <span class=\"token operator\">=</span> <span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">'users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<blockquote>\n<blockquote>\n<p>collection(firebase.ts에서 export한 db, ‘컬렉션 이름’)</p>\n</blockquote>\n</blockquote>\n<br />\n<h3 id=\"계층적-컬렉션\" style=\"position:relative;\"><a href=\"#%EA%B3%84%EC%B8%B5%EC%A0%81-%EC%BB%AC%EB%A0%89%EC%85%98\" aria-label=\"계층적 컬렉션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>계층적 컬렉션</h3>\n<br />\n<p>간단히 말해서 컬렉션 밑의 문서 밑에 <strong>하위 컬렉션</strong>을 둘 수 있다는 겁니다.</p>\n<p>예를 들어 채팅 앱의 경우 하위 컬렉션을 두면, 계층적으로 구조화 되어 메세지에 더욱 쉽게 접근할 수 있습니다.</p>\n<p>전체방이라는 컬렉션에 방들을 문서로 두고, 각 방들의 하위에 메세지라는 컬렉션을 두어 메세지들을 문서로 둔다면, 각 계층에 대한 구조를 쉽게 파악할 수 있습니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> doc <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span> \r\n<span class=\"token keyword\">const</span> messageRef <span class=\"token operator\">=</span> <span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"rooms\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"roomA\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"messages\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"message1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<h3 id=\"cloud-firestore에-데이터-추가\" style=\"position:relative;\"><a href=\"#cloud-firestore%EC%97%90-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B6%94%EA%B0%80\" aria-label=\"cloud firestore에 데이터 추가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cloud firestore에 데이터 추가</h3>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> doc<span class=\"token punctuation\">,</span> setDoc <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span> \r\n\r\n<span class=\"token comment\">// Add a new document in collection \"cities\"</span>\r\n<span class=\"token keyword\">await</span> <span class=\"token function\">setDoc</span><span class=\"token punctuation\">(</span><span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"LA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Los Angeles\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">state</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CA\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">country</span><span class=\"token operator\">:</span> <span class=\"token string\">\"USA\"</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>문서를 만들기 위해서는 위와 같이 <strong>setDoc메서드</strong>안에 참조 값을 넣어주고, 두번째 인자로 값을 <strong>key:value형식</strong>으로 넣어주면 됩니다.</p>\n<p>기본적으로 설정하지 않으면 기존에 존재하는 문서는 새로 덮어 씁니다. 병합하기 위해서는 다음 옵션을 추가해 주어야 합니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> doc<span class=\"token punctuation\">,</span> setDoc <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span> \r\n\r\n<span class=\"token keyword\">const</span> cityRef <span class=\"token operator\">=</span> <span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">'cities'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'BJ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">setDoc</span><span class=\"token punctuation\">(</span>cityRef<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">capital</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">merge</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>보통 문서를 추가하기 위해 doc()참조 함수를 통해 문서 ID(doc이름)을 지정해 주지만, 문서의 ID가 의미가 없는 경우 생략해서 생성하는 방법도 있습니다. 이때는 colletion() 참조함수와 addDoc()함수를 사용해 줍니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> collection<span class=\"token punctuation\">,</span> addDoc <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span> \r\n\r\n<span class=\"token comment\">// Add a new document with a generated id.</span>\r\n<span class=\"token keyword\">const</span> docRef <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">addDoc</span><span class=\"token punctuation\">(</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Tokyo\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">country</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Japan\"</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Document written with ID: \"</span><span class=\"token punctuation\">,</span> docRef<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<ul>\n<li>정리하자면 문서에 데이터 추가시 사용하는 함수는 <strong>setDoc, addDoc</strong>입니다.</li>\n</ul>\n<br />\n<h3 id=\"문서doc-업데이트\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%84%9Cdoc-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8\" aria-label=\"문서doc 업데이트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문서(doc) 업데이트</h3>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> doc<span class=\"token punctuation\">,</span> updateDoc <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> washingtonRef <span class=\"token operator\">=</span> <span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"DC\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Set the \"capital\" field of the city 'DC'</span>\r\n<span class=\"token keyword\">await</span> <span class=\"token function\">updateDoc</span><span class=\"token punctuation\">(</span>washingtonRef<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">capital</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n</code></pre></div>\n<br />\n<ul>\n<li>서버의 타임스탬프</li>\n</ul>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> updateDoc<span class=\"token punctuation\">,</span> serverTimestamp <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> docRef <span class=\"token operator\">=</span> <span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">'objects'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'some-id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Update the timestamp field with the value from the server</span>\r\n<span class=\"token keyword\">const</span> updateTimestamp <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">updateDoc</span><span class=\"token punctuation\">(</span>docRef<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">timestamp</span><span class=\"token operator\">:</span> <span class=\"token function\">serverTimestamp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>서버에 타임 스템프를 찍을수도 있습니다.</p>\n<br />\n<ul>\n<li>정리하자면 문서 수정을 위해서는 <strong>updateDoc()함수</strong>를 쓰고, 기본적으로 덮어 씁니다.</li>\n</ul>\n<br />\n<h3 id=\"문서-삭제\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%84%9C-%EC%82%AD%EC%A0%9C\" aria-label=\"문서 삭제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문서 삭제</h3>\n<br />\n<h4 id=\"doc-삭제\" style=\"position:relative;\"><a href=\"#doc-%EC%82%AD%EC%A0%9C\" aria-label=\"doc 삭제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Doc 삭제</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> doc<span class=\"token punctuation\">,</span> deleteDoc <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">await</span> <span class=\"token function\">deleteDoc</span><span class=\"token punctuation\">(</span><span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"DC\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>문서 삭제를 위해서 위와 같이 <strong>deleteDoc()</strong> 함수를 사용합니다.</p>\n<br />\n<h4 id=\"특정-필드-삭제\" style=\"position:relative;\"><a href=\"#%ED%8A%B9%EC%A0%95-%ED%95%84%EB%93%9C-%EC%82%AD%EC%A0%9C\" aria-label=\"특정 필드 삭제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>특정 필드 삭제</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> doc<span class=\"token punctuation\">,</span> updateDoc<span class=\"token punctuation\">,</span> deleteField <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> cityRef <span class=\"token operator\">=</span> <span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">'cities'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'BJ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Remove the 'capital' field from the document</span>\r\n<span class=\"token keyword\">await</span> <span class=\"token function\">updateDoc</span><span class=\"token punctuation\">(</span>cityRef<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">capital</span><span class=\"token operator\">:</span> <span class=\"token function\">deleteField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>doc안에 특정 필드만을 삭제하기 위해서는 **deleteField()**함수를 사용합니다.</p>\n<br />\n<h3 id=\"문서-가져오기\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%84%9C-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\" aria-label=\"문서 가져오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문서 가져오기</h3>\n<br />\n<h4 id=\"일반적인-경우-데이터-가져오기\" style=\"position:relative;\"><a href=\"#%EC%9D%BC%EB%B0%98%EC%A0%81%EC%9D%B8-%EA%B2%BD%EC%9A%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\" aria-label=\"일반적인 경우 데이터 가져오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>일반적인 경우 데이터 가져오기</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> doc<span class=\"token punctuation\">,</span> getDoc <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> docRef <span class=\"token operator\">=</span> <span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"SF\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> docSnap <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getDoc</span><span class=\"token punctuation\">(</span>docRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>docSnap<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Document data:\"</span><span class=\"token punctuation\">,</span> docSnap<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// doc.data() will be undefined in this case</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No such document!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br />\n<p>문서를 가져오는 경우에는 <strong>getDoc()함수</strong> 인자에 참조를 넣으면 됩니다.</p>\n<p>또한 함수의 존재 여부를 <strong>exists()함수</strong>를 통해 알 수 있으며, 문서안에 데이터는 <strong>data()함수</strong>로 알 수 있습니다.</p>\n<br />\n<h4 id=\"source-옵션을-통해-호출하는-경우\" style=\"position:relative;\"><a href=\"#source-%EC%98%B5%EC%85%98%EC%9D%84-%ED%86%B5%ED%95%B4-%ED%98%B8%EC%B6%9C%ED%95%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\" aria-label=\"source 옵션을 통해 호출하는 경우 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>source 옵션을 통해 호출하는 경우</h4>\n<br />\n<p>source 옵션을 켜주면 get 호출 시 오프라인 캐시를 사용하게 됩니다.</p>\n<p>이를 통해 네트워크를 사용할 수 없는 경우나 요청시간 초과 시 오프라인 캐시를 사용합니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> doc<span class=\"token punctuation\">,</span> getDocFromCache <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> docRef <span class=\"token operator\">=</span> <span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"SF\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Get a document, forcing the SDK to fetch from the offline cache.</span>\r\n<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> doc <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getDocFromCache</span><span class=\"token punctuation\">(</span>docRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Document was found in the cache. If no cached document exists,</span>\r\n  <span class=\"token comment\">// an error will be returned to the 'catch' block below.</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cached document data:\"</span><span class=\"token punctuation\">,</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error getting cached document:\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br />\n<h4 id=\"컬렉션에서-여러-문서-가져오기\" style=\"position:relative;\"><a href=\"#%EC%BB%AC%EB%A0%89%EC%85%98%EC%97%90%EC%84%9C-%EC%97%AC%EB%9F%AC-%EB%AC%B8%EC%84%9C-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\" aria-label=\"컬렉션에서 여러 문서 가져오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>컬렉션에서 여러 문서 가져오기</h4>\n<br />\n<p>컬렉션에서는 query함수를 통해서 여러 문서를 가져와 데이터를 출력할 수 있습니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> collection<span class=\"token punctuation\">,</span> query<span class=\"token punctuation\">,</span> where<span class=\"token punctuation\">,</span> getDocs <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> q <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"capital\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"==\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> querySnapshot <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getDocs</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nquerySnapshot<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">doc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// doc.data() is never undefined for query doc snapshots</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>doc<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token string\">\" => \"</span><span class=\"token punctuation\">,</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p><strong>query()함수</strong>는 첫번째 인자로 참조 값을 받고, 두번째 인자로 쿼리문을 받습니다. 여기서는 where조건 함수를 사용합니다.</p>\n<p>여기서 컬렉션 내의 모든 문서를 검색하기 위해서는 where조건 함수만 생략해 주면 됩니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">mport <span class=\"token punctuation\">{</span> collection<span class=\"token punctuation\">,</span> getDocs <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> querySnapshot <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getDocs</span><span class=\"token punctuation\">(</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nquerySnapshot<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">doc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// doc.data() is never undefined for query doc snapshots</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>doc<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token string\">\" => \"</span><span class=\"token punctuation\">,</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<h3 id=\"cloud-firestore로-실시간-데이터-수신하기\" style=\"position:relative;\"><a href=\"#cloud-firestore%EB%A1%9C-%EC%8B%A4%EC%8B%9C%EA%B0%84-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%88%98%EC%8B%A0%ED%95%98%EA%B8%B0\" aria-label=\"cloud firestore로 실시간 데이터 수신하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cloud Firestore로 실시간 데이터 수신하기</h3>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> doc<span class=\"token punctuation\">,</span> onSnapshot <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> unsub <span class=\"token operator\">=</span> <span class=\"token function\">onSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"SF\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">doc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Current data: \"</span><span class=\"token punctuation\">,</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p><strong>onSnapshot()함수</strong>를 통해 실시간으로 데이터를 수신할 수 있습니다.</p>\n<h4 id=\"event-for-local-changes\" style=\"position:relative;\"><a href=\"#event-for-local-changes\" aria-label=\"event for local changes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Event for local changes</h4>\n<p>local에서 쓰기를 진행하면 onSnapshot함수 콜백을 즉시 부르게 되는데, 이 이유는 “latency compensation”(지연보상)이라는 기능 때문에 벡엔드로 데이터가 전송되기 전에 콜백함수가 이를 인지한다고 합니다.</p>\n<p>이를 확인하는 방법은 doc참조 객체가 가지고 있는 <strong>metadata.hasPendingWrites</strong>를 이용하면 됩니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> doc<span class=\"token punctuation\">,</span> onSnapshot <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> unsub <span class=\"token operator\">=</span> <span class=\"token function\">onSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"SF\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">doc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> source <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>hasPendingWrites <span class=\"token operator\">?</span> <span class=\"token string\">\"Local\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"Server\"</span><span class=\"token punctuation\">;</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">,</span> <span class=\"token string\">\" data: \"</span><span class=\"token punctuation\">,</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<h4 id=\"컬렉션의-여러-문서-수신\" style=\"position:relative;\"><a href=\"#%EC%BB%AC%EB%A0%89%EC%85%98%EC%9D%98-%EC%97%AC%EB%9F%AC-%EB%AC%B8%EC%84%9C-%EC%88%98%EC%8B%A0\" aria-label=\"컬렉션의 여러 문서 수신 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>컬렉션의 여러 문서 수신</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> collection<span class=\"token punctuation\">,</span> query<span class=\"token punctuation\">,</span> where<span class=\"token punctuation\">,</span> onSnapshot <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> q <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"==\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"CA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> unsubscribe <span class=\"token operator\">=</span> <span class=\"token function\">onSnapshot</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">querySnapshot</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> cities <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n  querySnapshot<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">doc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      cities<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>doc<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Current cities in CA: \"</span><span class=\"token punctuation\">,</span> cities<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\", \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p><strong>컬렉션으로 Doc전체를 검색하고 쿼리문을 적용한 참조 값</strong>을 onSnapshot()함수의 첫번째 인자로 넣으면 콜백함수에서 하나하나 접근이 가능합니다.</p>\n<br />\n<h4 id=\"스냅샷의-변경-여부-실시간으로-확인하기\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%EB%83%85%EC%83%B7%EC%9D%98-%EB%B3%80%EA%B2%BD-%EC%97%AC%EB%B6%80-%EC%8B%A4%EC%8B%9C%EA%B0%84%EC%9C%BC%EB%A1%9C-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"스냅샷의 변경 여부 실시간으로 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스냅샷의 변경 여부 실시간으로 확인하기</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> collection<span class=\"token punctuation\">,</span> query<span class=\"token punctuation\">,</span> where<span class=\"token punctuation\">,</span> onSnapshot <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> q <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"==\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"CA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> unsubscribe <span class=\"token operator\">=</span> <span class=\"token function\">onSnapshot</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">snapshot</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  snapshot<span class=\"token punctuation\">.</span><span class=\"token function\">docChanges</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">change</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>change<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">\"added\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"New city: \"</span><span class=\"token punctuation\">,</span> change<span class=\"token punctuation\">.</span>doc<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>change<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">\"modified\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Modified city: \"</span><span class=\"token punctuation\">,</span> change<span class=\"token punctuation\">.</span>doc<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>change<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">\"removed\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Removed city: \"</span><span class=\"token punctuation\">,</span> change<span class=\"token punctuation\">.</span>doc<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>위처럼 onSnapshot의 콜백함수로 오는 snapshot의 <strong>docChanges()함수</strong>를 적용하고, 인자 하나 하나의 <strong>type</strong>을 검사해서 확인 할 수 있습니다.</p>\n<br />\n<h4 id=\"리스너-분리\" style=\"position:relative;\"><a href=\"#%EB%A6%AC%EC%8A%A4%EB%84%88-%EB%B6%84%EB%A6%AC\" aria-label=\"리스너 분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>리스너 분리</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> collection<span class=\"token punctuation\">,</span> onSnapshot <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> unsubscribe <span class=\"token operator\">=</span> <span class=\"token function\">onSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// Respond to data</span>\r\n  <span class=\"token comment\">// ...</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Later ...</span>\r\n\r\n<span class=\"token comment\">// Stop listening to changes</span>\r\n<span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>데이터 수신을 더이상 하고 싶지 않다면 이렇게 분리해야 합니다. 그래야 대역폭 사용을 줄일 수 있습니다.</p>\n<br />\n<h3 id=\"쿼리-사용\" style=\"position:relative;\"><a href=\"#%EC%BF%BC%EB%A6%AC-%EC%82%AC%EC%9A%A9\" aria-label=\"쿼리 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿼리 사용</h3>\n<br />\n<p>위에서 조금 사용했듯이 그렇게 어렵지 않습니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Create a reference to the cities collection</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> collection<span class=\"token punctuation\">,</span> query<span class=\"token punctuation\">,</span> where <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> citiesRef <span class=\"token operator\">=</span> <span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Create a query against the collection.</span>\r\n<span class=\"token keyword\">const</span> q <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>citiesRef<span class=\"token punctuation\">,</span> <span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"==\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"CA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>위처럼 query()함수의 첫번째 인자로 <strong>참조 값</strong>, 두번째 인자로 <strong>조건 함수</strong>를 집어넣으면 됩니다.</p>\n<p>이후 getDocs()함수와 forEach문으로 각 doc에 접근할 수 있습니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> querySnapshot <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getDocs</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nquerySnapshot<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">doc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// doc.data() is never undefined for query doc snapshots</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>doc<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token string\">\" => \"</span><span class=\"token punctuation\">,</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<h4 id=\"쿼리-연산자\" style=\"position:relative;\"><a href=\"#%EC%BF%BC%EB%A6%AC-%EC%97%B0%EC%82%B0%EC%9E%90\" aria-label=\"쿼리 연산자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿼리 연산자</h4>\n<br />\n<ul>\n<li>[ &#x3C; 미만 ]</li>\n<li>[ &#x3C;= 이하 ]</li>\n<li>[ == 같음 ]</li>\n<li>[ > 보다 큰 ]</li>\n<li>[ >= 크거나 같음]</li>\n<li>!= 같지 않음 ]</li>\n<li>[ array-contains ]</li>\n<li>[ array-contains-any ]</li>\n<li>[ in ]</li>\n<li>[ not in ]</li>\n</ul>\n<br />\n<h4 id=\"복합-쿼리\" style=\"position:relative;\"><a href=\"#%EB%B3%B5%ED%95%A9-%EC%BF%BC%EB%A6%AC\" aria-label=\"복합 쿼리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>복합 쿼리</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> query<span class=\"token punctuation\">,</span> where <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>  \r\n\r\n<span class=\"token keyword\">const</span> q1 <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>citiesRef<span class=\"token punctuation\">,</span> <span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\">=\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"CA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;=\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"IN\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> q2 <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>citiesRef<span class=\"token punctuation\">,</span> <span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"==\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"CA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"population\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\">\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<h4 id=\"컬렉션-그룹-쿼리\" style=\"position:relative;\"><a href=\"#%EC%BB%AC%EB%A0%89%EC%85%98-%EA%B7%B8%EB%A3%B9-%EC%BF%BC%EB%A6%AC\" aria-label=\"컬렉션 그룹 쿼리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>컬렉션 그룹 쿼리</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> collectionGroup<span class=\"token punctuation\">,</span> query<span class=\"token punctuation\">,</span> where<span class=\"token punctuation\">,</span> getDocs <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>  \r\n\r\n<span class=\"token keyword\">const</span> museums <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token function\">collectionGroup</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">'landmarks'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string\">'type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'=='</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'museum'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> querySnapshot <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getDocs</span><span class=\"token punctuation\">(</span>museums<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nquerySnapshot<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">doc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>doc<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token string\">' => '</span><span class=\"token punctuation\">,</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p><strong>collectionGroup()함수</strong>는 하위 컬렉션을 대상으로도 쿼리가 가능합니다.</p>\n<br />\n<h4 id=\"데이터-정렬과-제한\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%95%EB%A0%AC%EA%B3%BC-%EC%A0%9C%ED%95%9C\" aria-label=\"데이터 정렬과 제한 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터 정렬과 제한</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> query<span class=\"token punctuation\">,</span> where<span class=\"token punctuation\">,</span> orderBy<span class=\"token punctuation\">,</span> limit <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>  \r\n\r\n<span class=\"token keyword\">const</span> q <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>citiesRef<span class=\"token punctuation\">,</span> <span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"population\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\">\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"population\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"desc\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p><strong>orderBy()함수</strong>와 <strong>limit()함수</strong>로 쉽게 구현할 수 있습니다.</p>\n<br />\n<h4 id=\"집계-쿼리\" style=\"position:relative;\"><a href=\"#%EC%A7%91%EA%B3%84-%EC%BF%BC%EB%A6%AC\" aria-label=\"집계 쿼리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>집계 쿼리</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> coll <span class=\"token operator\">=</span> <span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> snapshot <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getCountFromServer</span><span class=\"token punctuation\">(</span>coll<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'count: '</span><span class=\"token punctuation\">,</span> snapshot<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>getCountFromServer()함수를 통해 snapshot을 가져온 뒤, count()함수를 적용합니다.</p>\n<br />\n<h3 id=\"페이지-네이션\" style=\"position:relative;\"><a href=\"#%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%84%A4%EC%9D%B4%EC%85%98\" aria-label=\"페이지 네이션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>페이지 네이션</h3>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> query<span class=\"token punctuation\">,</span> orderBy<span class=\"token punctuation\">,</span> startAt <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>  \r\n\r\n<span class=\"token keyword\">const</span> q <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>citiesRef<span class=\"token punctuation\">,</span> <span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"population\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">startAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>startAt()함수와 startAfter()함수가 있는데, 차이점은 시작점을 포함하냐 포함지 않느냐의 차이입니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> query<span class=\"token punctuation\">,</span> orderBy<span class=\"token punctuation\">,</span> endAt <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>  \r\n\r\n<span class=\"token keyword\">const</span> q <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>citiesRef<span class=\"token punctuation\">,</span> <span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"population\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">endAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>마찬가지로 endAt()와 endBefore()도 마찬가지 입니다.</p>\n<br />\n<p>혹은 문서 스냅샷을 통해서도 페이지 네이션을 구현할 수 있습니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> collection<span class=\"token punctuation\">,</span> doc<span class=\"token punctuation\">,</span> getDoc<span class=\"token punctuation\">,</span> query<span class=\"token punctuation\">,</span> orderBy<span class=\"token punctuation\">,</span> startAt <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>  \r\n<span class=\"token keyword\">const</span> citiesRef <span class=\"token operator\">=</span> <span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> docSnap <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getDoc</span><span class=\"token punctuation\">(</span><span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>citiesRef<span class=\"token punctuation\">,</span> <span class=\"token string\">\"SF\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Get all cities with a population bigger than San Francisco</span>\r\n<span class=\"token keyword\">const</span> biggerThanSf <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>citiesRef<span class=\"token punctuation\">,</span> <span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"population\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">startAt</span><span class=\"token punctuation\">(</span>docSnap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// ...</span></code></pre></div>\n<br />\n<p>위와 같이 getDoc로 문서를 가져온 후, docSnap을 startAt()함수의 인자로 전해줍니다.</p>\n<p>페이지 매김은 다음과 같이 limit()함수를 통해서 구현할 수 있습니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> collection<span class=\"token punctuation\">,</span> query<span class=\"token punctuation\">,</span> orderBy<span class=\"token punctuation\">,</span> startAfter<span class=\"token punctuation\">,</span> limit<span class=\"token punctuation\">,</span> getDocs <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/firestore\"</span><span class=\"token punctuation\">;</span>  \r\n\r\n<span class=\"token comment\">// Query the first page of docs</span>\r\n<span class=\"token keyword\">const</span> first <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"population\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token number\">25</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> documentSnapshots <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getDocs</span><span class=\"token punctuation\">(</span>first<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Get the last visible document</span>\r\n<span class=\"token keyword\">const</span> lastVisible <span class=\"token operator\">=</span> documentSnapshots<span class=\"token punctuation\">.</span>docs<span class=\"token punctuation\">[</span>documentSnapshots<span class=\"token punctuation\">.</span>docs<span class=\"token punctuation\">.</span>length<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"last\"</span><span class=\"token punctuation\">,</span> lastVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Construct a new query starting at this document,</span>\r\n<span class=\"token comment\">// get the next 25 cities.</span>\r\n<span class=\"token keyword\">const</span> next <span class=\"token operator\">=</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"cities\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"population\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token function\">startAfter</span><span class=\"token punctuation\">(</span>lastVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token number\">25</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<hr>\n<h2 id=\"cloud-storage-기본-사용법\" style=\"position:relative;\"><a href=\"#cloud-storage-%EA%B8%B0%EB%B3%B8-%EC%82%AC%EC%9A%A9%EB%B2%95\" aria-label=\"cloud storage 기본 사용법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cloud Storage 기본 사용법</h2>\n<br />\n<h4 id=\"참조\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EC%A1%B0\" aria-label=\"참조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참조</h4>\n<br />\n<h4 id=\"루트-경로-참조하기\" style=\"position:relative;\"><a href=\"#%EB%A3%A8%ED%8A%B8-%EA%B2%BD%EB%A1%9C-%EC%B0%B8%EC%A1%B0%ED%95%98%EA%B8%B0\" aria-label=\"루트 경로 참조하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>루트 경로 참조하기</h4>\n<br />\n<p>파일을 업로드, 다운로드, 삭제, 메타데이터 삭제 및 업로드를 하기 위해서는 파일에 대한 참조를 걸어주어야 합니다.</p>\n<p>이를 위해 서비스의 인스턴스를 가져오는 함수인 getStorage()를 통해 인스턴스를 가져오고, ref()함수를 통해 호출합니다.</p>\n<p>ref()를 통해 클라우드 스토리지 버킷의 루트를 가리키게 됩니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getStorage<span class=\"token punctuation\">,</span> ref <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/storage\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Get a reference to the storage service, which is used to create references in your storage bucket</span>\r\n<span class=\"token keyword\">const</span> storage <span class=\"token operator\">=</span> <span class=\"token function\">getStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Create a storage reference from our storage service</span>\r\n<span class=\"token keyword\">const</span> storageRef <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<h4 id=\"더-낮은-경로의-참조를-생성하기\" style=\"position:relative;\"><a href=\"#%EB%8D%94-%EB%82%AE%EC%9D%80-%EA%B2%BD%EB%A1%9C%EC%9D%98-%EC%B0%B8%EC%A1%B0%EB%A5%BC-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0\" aria-label=\"더 낮은 경로의 참조를 생성하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>더 낮은 경로의 참조를 생성하기</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getStorage<span class=\"token punctuation\">,</span> ref <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/storage\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> storage <span class=\"token operator\">=</span> <span class=\"token function\">getStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Create a child reference</span>\r\n<span class=\"token keyword\">const</span> imagesRef <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">,</span> <span class=\"token string\">'images'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// imagesRef now points to 'images'</span>\r\n\r\n<span class=\"token comment\">// Child references can also take paths delimited by '/'</span>\r\n<span class=\"token keyword\">const</span> spaceRef <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">,</span> <span class=\"token string\">'images/space.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// spaceRef now points to \"images/space.jpg\"</span>\r\n<span class=\"token comment\">// imagesRef still points to \"images\"</span></code></pre></div>\n<br />\n<p>더 낮은 경로의 참조를 생성하기 위해서는 위와 같이 ref()함수의 두번째 인자에 경로를 집어넣으면 됩니다.</p>\n<br />\n<h3 id=\"파일-업로드-하기\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C-%ED%95%98%EA%B8%B0\" aria-label=\"파일 업로드 하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일 업로드 하기</h3>\n<br />\n<h4 id=\"blob-또는-file에서-업로드\" style=\"position:relative;\"><a href=\"#blob-%EB%98%90%EB%8A%94-file%EC%97%90%EC%84%9C-%EC%97%85%EB%A1%9C%EB%93%9C\" aria-label=\"blob 또는 file에서 업로드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Blob 또는 File에서 업로드</h4>\n<br />\n<p>uploadBytes()메서드를 통해서 업로드할 수 있습니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getStorage<span class=\"token punctuation\">,</span> ref<span class=\"token punctuation\">,</span> uploadBytes <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/storage\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> storage <span class=\"token operator\">=</span> <span class=\"token function\">getStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> storageRef <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">,</span> <span class=\"token string\">'some-child'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// 'file' comes from the Blob or File API</span>\r\n<span class=\"token function\">uploadBytes</span><span class=\"token punctuation\">(</span>storageRef<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">snapshot</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Uploaded a blob or file!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<h4 id=\"base64-base64url-data_url-업로드\" style=\"position:relative;\"><a href=\"#base64-base64url-data_url-%EC%97%85%EB%A1%9C%EB%93%9C\" aria-label=\"base64 base64url data_url 업로드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>base64, base64url, data_url 업로드</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getStorage<span class=\"token punctuation\">,</span> ref<span class=\"token punctuation\">,</span> uploadString <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/storage\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> storage <span class=\"token operator\">=</span> <span class=\"token function\">getStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> storageRef <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">,</span> <span class=\"token string\">'some-child'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Raw string is the default if no format is provided</span>\r\n<span class=\"token keyword\">const</span> message <span class=\"token operator\">=</span> <span class=\"token string\">'This is my message.'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">uploadString</span><span class=\"token punctuation\">(</span>storageRef<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">snapshot</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Uploaded a raw string!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Base64 formatted string</span>\r\n<span class=\"token keyword\">const</span> message2 <span class=\"token operator\">=</span> <span class=\"token string\">'5b6p5Y+344GX44G+44GX44Gf77yB44GK44KB44Gn44Go44GG77yB'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">uploadString</span><span class=\"token punctuation\">(</span>storageRef<span class=\"token punctuation\">,</span> message2<span class=\"token punctuation\">,</span> <span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">snapshot</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Uploaded a base64 string!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Base64url formatted string</span>\r\n<span class=\"token keyword\">const</span> message3 <span class=\"token operator\">=</span> <span class=\"token string\">'5b6p5Y-344GX44G-44GX44Gf77yB44GK44KB44Gn44Go44GG77yB'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">uploadString</span><span class=\"token punctuation\">(</span>storageRef<span class=\"token punctuation\">,</span> message3<span class=\"token punctuation\">,</span> <span class=\"token string\">'base64url'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">snapshot</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Uploaded a base64url string!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Data URL string</span>\r\n<span class=\"token keyword\">const</span> message4 <span class=\"token operator\">=</span> <span class=\"token string\">'data:text/plain;base64,5b6p5Y+344GX44G+44GX44Gf77yB44GK44KB44Gn44Go44GG77yB'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">uploadString</span><span class=\"token punctuation\">(</span>storageRef<span class=\"token punctuation\">,</span> message4<span class=\"token punctuation\">,</span> <span class=\"token string\">'data_url'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">snapshot</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Uploaded a data_url string!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>base64, base64url, data_url의 경우 위와 같이 <strong>uploadString()함수</strong>를 통해 업로드가 가능합니다. 세번째 인자로는 데이터 유형에 대해 언급해 줍니다.</p>\n<br />\n<h4 id=\"업로드-일시-중지-재개-취소\" style=\"position:relative;\"><a href=\"#%EC%97%85%EB%A1%9C%EB%93%9C-%EC%9D%BC%EC%8B%9C-%EC%A4%91%EC%A7%80-%EC%9E%AC%EA%B0%9C-%EC%B7%A8%EC%86%8C\" aria-label=\"업로드 일시 중지 재개 취소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>업로드 일시 중지, 재개, 취소</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getStorage<span class=\"token punctuation\">,</span> ref<span class=\"token punctuation\">,</span> uploadBytesResumable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/storage\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> storage <span class=\"token operator\">=</span> <span class=\"token function\">getStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> storageRef <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">,</span> <span class=\"token string\">'images/mountains.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Upload the file and metadata</span>\r\n<span class=\"token keyword\">const</span> uploadTask <span class=\"token operator\">=</span> <span class=\"token function\">uploadBytesResumable</span><span class=\"token punctuation\">(</span>storageRef<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Pause the upload</span>\r\nuploadTask<span class=\"token punctuation\">.</span><span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Resume the upload</span>\r\nuploadTask<span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Cancel the upload</span>\r\nuploadTask<span class=\"token punctuation\">.</span><span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>업로드 중지, 재개, 취소는 각각 **pause(), resume(), cancel()**메서드를 통해 구현합니다.</p>\n<br />\n<h4 id=\"업로드-진행-상황-모니터링\" style=\"position:relative;\"><a href=\"#%EC%97%85%EB%A1%9C%EB%93%9C-%EC%A7%84%ED%96%89-%EC%83%81%ED%99%A9-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81\" aria-label=\"업로드 진행 상황 모니터링 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>업로드 진행 상황 모니터링</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getStorage<span class=\"token punctuation\">,</span> ref<span class=\"token punctuation\">,</span> uploadBytesResumable<span class=\"token punctuation\">,</span> getDownloadURL <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/storage\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> storage <span class=\"token operator\">=</span> <span class=\"token function\">getStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> storageRef <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">,</span> <span class=\"token string\">'images/rivers.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> uploadTask <span class=\"token operator\">=</span> <span class=\"token function\">uploadBytesResumable</span><span class=\"token punctuation\">(</span>storageRef<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Register three observers:</span>\r\n<span class=\"token comment\">// 1. 'state_changed' observer, called any time the state changes</span>\r\n<span class=\"token comment\">// 2. Error observer, called on failure</span>\r\n<span class=\"token comment\">// 3. Completion observer, called on successful completion</span>\r\nuploadTask<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'state_changed'</span><span class=\"token punctuation\">,</span> \r\n  <span class=\"token punctuation\">(</span><span class=\"token parameter\">snapshot</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// Observe state change events such as progress, pause, and resume</span>\r\n    <span class=\"token comment\">// Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded</span>\r\n    <span class=\"token keyword\">const</span> progress <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>snapshot<span class=\"token punctuation\">.</span>bytesTransferred <span class=\"token operator\">/</span> snapshot<span class=\"token punctuation\">.</span>totalBytes<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\r\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Upload is '</span> <span class=\"token operator\">+</span> progress <span class=\"token operator\">+</span> <span class=\"token string\">'% done'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>snapshot<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'paused'</span><span class=\"token operator\">:</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Upload is paused'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'running'</span><span class=\"token operator\">:</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Upload is running'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \r\n  <span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// Handle unsuccessful uploads</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \r\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// Handle successful uploads on complete</span>\r\n    <span class=\"token comment\">// For instance, get the download URL: https://firebasestorage.googleapis.com/...</span>\r\n    <span class=\"token function\">getDownloadURL</span><span class=\"token punctuation\">(</span>uploadTask<span class=\"token punctuation\">.</span>snapshot<span class=\"token punctuation\">.</span>ref<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">downloadURL</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'File available at'</span><span class=\"token punctuation\">,</span> downloadURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p><strong>state_changed</strong>인자를 전달해 준다면, state가 변할 때 마다 호출됩니다.</p>\n<p><strong>totalBytes</strong>는 업로드 될 것으로 예상되는 총 바이트 수입니다.</p>\n<p><strong>byteTransferred</strong>는 이 스냅샷이 생성될 때 전달된 총 바이트 수입니다.</p>\n<p><strong>state</strong>는 현재 업로드 상태를 말합니다.</p>\n<p><strong>ref</strong>는 이 작업의 출처로 downloadURL을 반환합니다.</p>\n<br />\n<h3 id=\"파일-다운로드-하기\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC-%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C-%ED%95%98%EA%B8%B0\" aria-label=\"파일 다운로드 하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일 다운로드 하기</h3>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getStorage<span class=\"token punctuation\">,</span> ref<span class=\"token punctuation\">,</span> getDownloadURL <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/storage\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> storage <span class=\"token operator\">=</span> <span class=\"token function\">getStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">getDownloadURL</span><span class=\"token punctuation\">(</span><span class=\"token function\">ref</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">,</span> <span class=\"token string\">'images/stars.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// `url` is the download URL for 'images/stars.jpg'</span>\r\n\r\n    <span class=\"token comment\">// This can be downloaded directly:</span>\r\n    <span class=\"token keyword\">const</span> xhr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    xhr<span class=\"token punctuation\">.</span>responseType <span class=\"token operator\">=</span> <span class=\"token string\">'blob'</span><span class=\"token punctuation\">;</span>\r\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> blob <span class=\"token operator\">=</span> xhr<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// Or inserted into an &lt;img> element</span>\r\n    <span class=\"token keyword\">const</span> img <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'myimg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    img<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// Handle any errors</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p><strong>getDownloadURL</strong>을 호출하여 스토리지의 참조 객체를 전달해줍니다.</p>\n<br />\n<h4 id=\"cors-처리\" style=\"position:relative;\"><a href=\"#cors-%EC%B2%98%EB%A6%AC\" aria-label=\"cors 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CORS 처리</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\r\n  <span class=\"token punctuation\">{</span>\r\n    <span class=\"token property\">\"origin\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token property\">\"method\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token property\">\"maxAgeSeconds\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3600</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">]</span></code></pre></div>\n<br />\n<p>브라우저에서 직접 데이터를 다운로드하기 위해서는 CORS에 대한 버킷을 생성해야 합니다.</p>\n<p>위 json코드는 도메인 제한을 두지 않는 JSON파일로 cors.json이라는 파일로 복사하면 됩니다.</p>\n<br />\n<h3 id=\"파일-삭제\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC-%EC%82%AD%EC%A0%9C\" aria-label=\"파일 삭제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일 삭제</h3>\n<br />\n<p>deleteObject()함수를 통해서 파일을 삭제할 수 있습니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getStorage<span class=\"token punctuation\">,</span> ref<span class=\"token punctuation\">,</span> deleteObject <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/storage\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> storage <span class=\"token operator\">=</span> <span class=\"token function\">getStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Create a reference to the file to delete</span>\r\n<span class=\"token keyword\">const</span> desertRef <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">,</span> <span class=\"token string\">'images/desert.jpg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Delete the file</span>\r\n<span class=\"token function\">deleteObject</span><span class=\"token punctuation\">(</span>desertRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// File deleted successfully</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// Uh-oh, an error occurred!</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<hr>\n<br />\n<h2 id=\"firestore와-firestorage-사용-팁\" style=\"position:relative;\"><a href=\"#firestore%EC%99%80-firestorage-%EC%82%AC%EC%9A%A9-%ED%8C%81\" aria-label=\"firestore와 firestorage 사용 팁 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FireStore와 FireStorage 사용 팁</h2>\n<br />\n<h3 id=\"파일-가져오기-전략\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0-%EC%A0%84%EB%9E%B5\" aria-label=\"파일 가져오기 전략 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일 가져오기 전략</h3>\n<br />\n<p>파일을 가져오기 위한 HTML 참조 객체를 useRef를 통해 만듭니다. 그후, 파일 저장을 위한 state도 만들어 줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>selectedFile<span class=\"token punctuation\">,</span> setSelectedFile<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>클릭 시 참조 HTML이 클릭 되게끔 onClick 메서드를 원하는 HTML 태그에 달아준다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> filePickerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></code></pre></div>\n<br />\n<p>참조 HTML 태그에는 onChange={addImageToPost}를 달아서 클릭 시 함수가 발생하도록 한다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">addImageToPost</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">e</span><span class=\"token operator\">:</span>any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">readEvent</span><span class=\"token operator\">:</span>any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">setSelectedFile</span><span class=\"token punctuation\">(</span>readEvent<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br />\n<p>위 함수는 FileReader 객체를 가져와서 file형식의 데이터를 URL로 읽습니다. 이후, reader가 선택되고, 로드되면 선택된 파일의 state를 새로 저장합니다.</p>\n<br />\n<h3 id=\"이미지-업로드-및-다운로드-url을-doc에-업로드\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%97%85%EB%A1%9C%EB%93%9C-%EB%B0%8F-%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C-url%EC%9D%84-doc%EC%97%90-%EC%97%85%EB%A1%9C%EB%93%9C\" aria-label=\"이미지 업로드 및 다운로드 url을 doc에 업로드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이미지 업로드 및 다운로드 URL을 DOC에 업로드</h3>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">await</span> <span class=\"token function\">uploadString</span><span class=\"token punctuation\">(</span>imageRef<span class=\"token punctuation\">,</span> selectedFile<span class=\"token punctuation\">,</span> <span class=\"token string\">\"data_url\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">snapshot</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> downloadURL <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getDownloadURL</span><span class=\"token punctuation\">(</span>imageRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">await</span> <span class=\"token function\">updateDoc</span><span class=\"token punctuation\">(</span><span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"posts\"</span><span class=\"token punctuation\">,</span> docRef<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token literal-property property\">image</span><span class=\"token operator\">:</span> downloadURL\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br />\n<h3 id=\"실시간으로-데이터-적용하기\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%EC%8B%9C%EA%B0%84%EC%9C%BC%EB%A1%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"실시간으로 데이터 적용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실시간으로 데이터 적용하기</h3>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">onSnapshot</span><span class=\"token punctuation\">(</span>\r\n            <span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"posts\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token string\">'timestamp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'desc'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">snapshot</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">setPosts</span><span class=\"token punctuation\">(</span>snapshot<span class=\"token punctuation\">.</span>docs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>db<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br />\n<p>위처럼 useEffect()함수를 사용하면, db에 변경이 생길 때 마다 실행하며, onSnapshot()함수로 실시간으로 데이터 변경 시 콜백함수를 호출할 수 있습니다.</p>\n<br />\n<p>즉,<strong>db 변경</strong>이라는 조건 하에 <strong>실시간</strong>으로 데이터를 변경하는 겁니다.</p>\n<br />\n<h3 id=\"좋아요-수를-firestore에서-다루기\" style=\"position:relative;\"><a href=\"#%EC%A2%8B%EC%95%84%EC%9A%94-%EC%88%98%EB%A5%BC-firestore%EC%97%90%EC%84%9C-%EB%8B%A4%EB%A3%A8%EA%B8%B0\" aria-label=\"좋아요 수를 firestore에서 다루기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>좋아요 수를 Firestore에서 다루기</h3>\n<br />\n<h4 id=\"좋아요가-있는-지-확인하기\" style=\"position:relative;\"><a href=\"#%EC%A2%8B%EC%95%84%EC%9A%94%EA%B0%80-%EC%9E%88%EB%8A%94-%EC%A7%80-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"좋아요가 있는 지 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>좋아요가 있는 지 확인하기</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"> <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">setHasLiked</span><span class=\"token punctuation\">(</span>likes<span class=\"token punctuation\">.</span><span class=\"token function\">findIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">like</span><span class=\"token operator\">:</span>any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> like<span class=\"token punctuation\">.</span>id <span class=\"token operator\">===</span> session<span class=\"token operator\">?.</span>user<span class=\"token operator\">?.</span>uid<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>likes<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>js의 findIndex()함수를 통해서 좋아요가 있는 지 확인합니다.</p>\n<br />\n<h4 id=\"좋아요-삭제하기\" style=\"position:relative;\"><a href=\"#%EC%A2%8B%EC%95%84%EC%9A%94-%EC%82%AD%EC%A0%9C%ED%95%98%EA%B8%B0\" aria-label=\"좋아요 삭제하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>좋아요 삭제하기</h4>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">await</span> <span class=\"token function\">deleteDoc</span><span class=\"token punctuation\">(</span><span class=\"token function\">doc</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> <span class=\"token string\">\"posts\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> <span class=\"token string\">\"likes\"</span><span class=\"token punctuation\">,</span> session<span class=\"token operator\">?.</span>user<span class=\"token operator\">?.</span>uid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br />\n<p>update하는 거랑 유사합니다. 올린 그대로 삭제하면 됩니다.(하위 컬렉션 조작)</p>\n<br />\n<hr>\n<br />\n<h2 id=\"끝맺음\" style=\"position:relative;\"><a href=\"#%EB%81%9D%EB%A7%BA%EC%9D%8C\" aria-label=\"끝맺음 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>끝맺음</h2>\n<br />\n<p>이 이외에도 파이어베이스는 Realtime database, 인증, 보안, Cloud Function 등 사용할 수 있는 제품이 늘어나고 있습니다.</p>\n<p>복잡한 벡엔드 작업과 더욱 빠른 속도를 원한다면 직접 벡엔드 서버를 구축하는게 좋으나, 안정성 있으면서 편하게 쓸 수 있고, 속도도 그리 나쁘지 않은(체감상…) 개발에는 파이어베이스를 사용하는게 좋아보입니다.</p>\n<p>특히 벡엔드에 신경을 몰두하지 않아도, 유지 보수에 있어 탁월하다는 점이 매우 좋은 것 같습니다.</p>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<ul>\n<li><a href=\"https://firebase.google.com/docs?hl=ko\">https://firebase.google.com/docs?hl=ko</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#1-firebase-%EC%97%B0%EB%8F%99\">1. Firebase 연동</a></p>\n</li>\n<li>\n<p><a href=\"#2-cloud-firestore-%EA%B8%B0%EB%B3%B8-%EC%82%AC%EC%9A%A9%EB%B2%95\">2. Cloud Firestore 기본 사용법</a></p>\n<ul>\n<li>\n<p><a href=\"#doc%EB%AC%B8%EC%84%9C-%EC%B0%B8%EC%A1%B0\">Doc(문서) 참조</a></p>\n</li>\n<li>\n<p><a href=\"#collection%EC%BB%AC%EB%A0%89%EC%85%98-%EC%B0%B8%EC%A1%B0\">Collection(컬렉션) 참조</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B3%84%EC%B8%B5%EC%A0%81-%EC%BB%AC%EB%A0%89%EC%85%98\">계층적 컬렉션</a></p>\n</li>\n<li>\n<p><a href=\"#cloud-firestore%EC%97%90-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B6%94%EA%B0%80\">Cloud firestore에 데이터 추가</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%84%9Cdoc-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8\">문서(doc) 업데이트</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%84%9C-%EC%82%AD%EC%A0%9C\">문서 삭제</a></p>\n<ul>\n<li><a href=\"#doc-%EC%82%AD%EC%A0%9C\">Doc 삭제</a></li>\n<li><a href=\"#%ED%8A%B9%EC%A0%95-%ED%95%84%EB%93%9C-%EC%82%AD%EC%A0%9C\">특정 필드 삭제</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%84%9C-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\">문서 가져오기</a></p>\n<ul>\n<li><a href=\"#%EC%9D%BC%EB%B0%98%EC%A0%81%EC%9D%B8-%EA%B2%BD%EC%9A%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\">일반적인 경우 데이터 가져오기</a></li>\n<li><a href=\"#source-%EC%98%B5%EC%85%98%EC%9D%84-%ED%86%B5%ED%95%B4-%ED%98%B8%EC%B6%9C%ED%95%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\">source 옵션을 통해 호출하는 경우</a></li>\n<li><a href=\"#%EC%BB%AC%EB%A0%89%EC%85%98%EC%97%90%EC%84%9C-%EC%97%AC%EB%9F%AC-%EB%AC%B8%EC%84%9C-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\">컬렉션에서 여러 문서 가져오기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#cloud-firestore%EB%A1%9C-%EC%8B%A4%EC%8B%9C%EA%B0%84-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%88%98%EC%8B%A0%ED%95%98%EA%B8%B0\">Cloud Firestore로 실시간 데이터 수신하기</a></p>\n<ul>\n<li><a href=\"#event-for-local-changes\">Event for local changes</a></li>\n<li><a href=\"#%EC%BB%AC%EB%A0%89%EC%85%98%EC%9D%98-%EC%97%AC%EB%9F%AC-%EB%AC%B8%EC%84%9C-%EC%88%98%EC%8B%A0\">컬렉션의 여러 문서 수신</a></li>\n<li><a href=\"#%EC%8A%A4%EB%83%85%EC%83%B7%EC%9D%98-%EB%B3%80%EA%B2%BD-%EC%97%AC%EB%B6%80-%EC%8B%A4%EC%8B%9C%EA%B0%84%EC%9C%BC%EB%A1%9C-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\">스냅샷의 변경 여부 실시간으로 확인하기</a></li>\n<li><a href=\"#%EB%A6%AC%EC%8A%A4%EB%84%88-%EB%B6%84%EB%A6%AC\">리스너 분리</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%BF%BC%EB%A6%AC-%EC%82%AC%EC%9A%A9\">쿼리 사용</a></p>\n<ul>\n<li><a href=\"#%EC%BF%BC%EB%A6%AC-%EC%97%B0%EC%82%B0%EC%9E%90\">쿼리 연산자</a></li>\n<li><a href=\"#%EB%B3%B5%ED%95%A9-%EC%BF%BC%EB%A6%AC\">복합 쿼리</a></li>\n<li><a href=\"#%EC%BB%AC%EB%A0%89%EC%85%98-%EA%B7%B8%EB%A3%B9-%EC%BF%BC%EB%A6%AC\">컬렉션 그룹 쿼리</a></li>\n<li><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%95%EB%A0%AC%EA%B3%BC-%EC%A0%9C%ED%95%9C\">데이터 정렬과 제한</a></li>\n<li><a href=\"#%EC%A7%91%EA%B3%84-%EC%BF%BC%EB%A6%AC\">집계 쿼리</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%84%A4%EC%9D%B4%EC%85%98\">페이지 네이션</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#cloud-storage-%EA%B8%B0%EB%B3%B8-%EC%82%AC%EC%9A%A9%EB%B2%95\">Cloud Storage 기본 사용법</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%EC%B0%B8%EC%A1%B0\">참조</a></li>\n<li><a href=\"#%EB%A3%A8%ED%8A%B8-%EA%B2%BD%EB%A1%9C-%EC%B0%B8%EC%A1%B0%ED%95%98%EA%B8%B0\">루트 경로 참조하기</a></li>\n<li><a href=\"#%EB%8D%94-%EB%82%AE%EC%9D%80-%EA%B2%BD%EB%A1%9C%EC%9D%98-%EC%B0%B8%EC%A1%B0%EB%A5%BC-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0\">더 낮은 경로의 참조를 생성하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C-%ED%95%98%EA%B8%B0\">파일 업로드 하기</a></p>\n<ul>\n<li><a href=\"#blob-%EB%98%90%EB%8A%94-file%EC%97%90%EC%84%9C-%EC%97%85%EB%A1%9C%EB%93%9C\">Blob 또는 File에서 업로드</a></li>\n<li><a href=\"#base64-base64url-data_url-%EC%97%85%EB%A1%9C%EB%93%9C\">base64, base64url, data_url 업로드</a></li>\n<li><a href=\"#%EC%97%85%EB%A1%9C%EB%93%9C-%EC%9D%BC%EC%8B%9C-%EC%A4%91%EC%A7%80-%EC%9E%AC%EA%B0%9C-%EC%B7%A8%EC%86%8C\">업로드 일시 중지, 재개, 취소</a></li>\n<li><a href=\"#%EC%97%85%EB%A1%9C%EB%93%9C-%EC%A7%84%ED%96%89-%EC%83%81%ED%99%A9-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81\">업로드 진행 상황 모니터링</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%8C%8C%EC%9D%BC-%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C-%ED%95%98%EA%B8%B0\">파일 다운로드 하기</a></p>\n<ul>\n<li><a href=\"#cors-%EC%B2%98%EB%A6%AC\">CORS 처리</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%8C%8C%EC%9D%BC-%EC%82%AD%EC%A0%9C\">파일 삭제</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#firestore%EC%99%80-firestorage-%EC%82%AC%EC%9A%A9-%ED%8C%81\">FireStore와 FireStorage 사용 팁</a></p>\n<ul>\n<li>\n<p><a href=\"#%ED%8C%8C%EC%9D%BC-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0-%EC%A0%84%EB%9E%B5\">파일 가져오기 전략</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%97%85%EB%A1%9C%EB%93%9C-%EB%B0%8F-%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C-url%EC%9D%84-doc%EC%97%90-%EC%97%85%EB%A1%9C%EB%93%9C\">이미지 업로드 및 다운로드 URL을 DOC에 업로드</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%8B%A4%EC%8B%9C%EA%B0%84%EC%9C%BC%EB%A1%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\">실시간으로 데이터 적용하기</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A2%8B%EC%95%84%EC%9A%94-%EC%88%98%EB%A5%BC-firestore%EC%97%90%EC%84%9C-%EB%8B%A4%EB%A3%A8%EA%B8%B0\">좋아요 수를 Firestore에서 다루기</a></p>\n<ul>\n<li><a href=\"#%EC%A2%8B%EC%95%84%EC%9A%94%EA%B0%80-%EC%9E%88%EB%8A%94-%EC%A7%80-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\">좋아요가 있는 지 확인하기</a></li>\n<li><a href=\"#%EC%A2%8B%EC%95%84%EC%9A%94-%EC%82%AD%EC%A0%9C%ED%95%98%EA%B8%B0\">좋아요 삭제하기</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%81%9D%EB%A7%BA%EC%9D%8C\">끝맺음</a></p>\n</li>\n<li>\n<p><a href=\"#reference\">Reference</a></p>\n</li>\n</ul>\n</div>","excerpt":"Firebase Doc 정리해보기 기본적으로 소규모 스타트업에서 벡엔드를 직접 구축한다면 서버 인프라 관리부터 서버단/클라이언트 개발을 모두 신경써야 합니다.\r\n소규모 인원으로 프로젝트를 진행한다면 사용자 피드백을 받아들이기 매우 버겁죠. 하지만 Firebase를 이용한다면 Database, Storage, Auth, Analytics까지 제공해주기 때문에 벡엔드에 대한 큰 고민 없이 서비스를 제작할 수 있습니다. 1. Firebase 연동 연동을 위해서는 Firebase 홈페이지에서 SDK를 통해 연동을 해주어야 합니다. 프로젝트 만들기를 통해 firebase 프로젝트를 만들어 주세요. 그리고 프로젝트 설정에서 웹앱 만들기로 들어가 주어지는 코드를 루트 폴더의 firebase.ts에 입력해 줍니다. 이제 원하는 프로젝트의 빌드 제품을 사용하기 위해서 일련의 설정을 해야합니다. 우선 firebase.ts의 가장 아래쪽을 위 문장으로 수정해줍니다. 이는 앱이 구성되어 있지 않으면 새…","frontmatter":{"date":"November 17, 2022","title":"Firebase - Firestore와 Storage 사용법","categories":"WEB-DEV","author":"DEVEL","emoji":"💡"},"fields":{"slug":"/web-dev-2/"}},"next":{"id":"3ce9d2b2-ef6a-5bbf-905b-1b606cf1aeb4","html":"<p>아래는 인증을 위한 전역 컨텍스트를 모아둔 파일입니다.</p>\n<p>firebase의 auth 함수들을 이용해 인증 상태를 관리합니다.</p>\n<p>그리고 그 결과를 전역 컨텍스트 createContext()를 만들어 Provider안에 value로 전달해 전역적으로 적용 되게끔 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> createContext<span class=\"token punctuation\">,</span> useContext<span class=\"token punctuation\">,</span> useEffect<span class=\"token punctuation\">,</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> onAuthStateChanged<span class=\"token punctuation\">,</span> createUserWithEmailAndPassword<span class=\"token punctuation\">,</span> signInWithEmailAndPassword<span class=\"token punctuation\">,</span> signOut <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"firebase/auth\"</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> auth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../config/firebase\"</span><span class=\"token punctuation\">;</span>\r\n\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useAuth</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>AuthContext<span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">const</span> AuthContext <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createContext</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">AuthContextProvider</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> children<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>ReactNode <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>user<span class=\"token punctuation\">,</span> setUser<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>loading<span class=\"token punctuation\">,</span> setLoading<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> unsubscribe <span class=\"token operator\">=</span> <span class=\"token function\">onAuthStateChanged</span><span class=\"token punctuation\">(</span>auth<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">setUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n                    uid<span class=\"token operator\">:</span> user<span class=\"token punctuation\">.</span>uid<span class=\"token punctuation\">,</span>\r\n                    email<span class=\"token operator\">:</span> user<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">,</span>\r\n                    displayName<span class=\"token operator\">:</span> user<span class=\"token punctuation\">.</span>displayName<span class=\"token punctuation\">,</span>\r\n                    \r\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">setUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n\r\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\r\n\r\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">signup</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>email<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> password<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token function\">createUserWithEmailAndPassword</span><span class=\"token punctuation\">(</span>auth<span class=\"token punctuation\">,</span> email<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">login</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>email<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> password<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token function\">signInWithEmailAndPassword</span><span class=\"token punctuation\">(</span>auth<span class=\"token punctuation\">,</span> email<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">logout</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">setUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token keyword\">await</span> <span class=\"token function\">signOut</span><span class=\"token punctuation\">(</span>auth<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>AuthContext<span class=\"token punctuation\">.</span>Provider value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">,</span> login<span class=\"token punctuation\">,</span> signup<span class=\"token punctuation\">,</span> logout <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>AuthContext<span class=\"token punctuation\">.</span>Provider<span class=\"token operator\">></span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>커스텀 app.tsx는 다음과 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token string\">'../styles/globals.css'</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> AppProps <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/app'</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> SessionProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"next-auth/react\"</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthContextProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../context/AuthContext'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRouter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/router'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> ProtectedRoute <span class=\"token keyword\">from</span> <span class=\"token string\">'../components/ProtectedRoute'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> AuthRequired <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'/administor'</span><span class=\"token punctuation\">]</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> AppProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\r\n  <span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">useRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>AuthContextProvider<span class=\"token operator\">></span>\r\n\r\n      <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>AuthRequired<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>router<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>Component <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>pageProps<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n      <span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>ProtectedRoute<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>Component <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>pageProps<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ProtectedRoute<span class=\"token operator\">></span>\r\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n      \r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>AuthContextProvider<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> MyApp</code></pre></div>\n<p>이렇게 프로바이더로 감싸주면, 전역 컨텍스트가 children으로 전달됩니다.</p>\n<p>로그인, 로그아웃, 회원가입 함수가 포함된 전역 컨텍스트를 사용하는 방법은 다음과 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PhotoIcon <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@heroicons/react/24/solid'</span>\r\n<span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\r\n<span class=\"token keyword\">import</span> ContentDropDown <span class=\"token keyword\">from</span> <span class=\"token string\">'../../components/ContentDropDown'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> Header <span class=\"token keyword\">from</span> <span class=\"token string\">'../../components/Header'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useForm<span class=\"token punctuation\">,</span> SubmitHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-hook-form\"</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useAuth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../context/AuthContext'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Inputs</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n  email<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\r\n  password<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Props</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">signin</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>props<span class=\"token operator\">:</span> Props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">,</span> login <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useAuth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">,</span> setData<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    email<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\r\n    password<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> register<span class=\"token punctuation\">,</span> handleSubmit<span class=\"token punctuation\">,</span> watch<span class=\"token punctuation\">,</span> formState<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> errors <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useForm</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Inputs<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\r\n  <span class=\"token keyword\">const</span> onSubmit<span class=\"token operator\">:</span> SubmitHandler<span class=\"token operator\">&lt;</span>Inputs<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">await</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'bg-light-1 h-screen flex justify-center items-center'</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">'bg-white px-[20px] py-[60px] rounded-md flex flex-col items-center'</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>span className<span class=\"token operator\">=</span><span class=\"token string\">'text-[#5d5b8d] font-semibold text-2xl mb-4'</span><span class=\"token operator\">></span>로그인<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>form className<span class=\"token operator\">=</span><span class=\"token string\">'flex flex-col gap-4'</span> onSubmit<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">handleSubmit</span><span class=\"token punctuation\">(</span>onSubmit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>input className<span class=\"token operator\">=</span><span class=\"token string\">'RegisterInput'</span> type<span class=\"token operator\">=</span><span class=\"token string\">\"email\"</span> placeholder<span class=\"token operator\">=</span><span class=\"token string\">'display name'</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"email\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>required<span class=\"token operator\">:</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>input className<span class=\"token operator\">=</span><span class=\"token string\">'RegisterInput'</span> type<span class=\"token operator\">=</span><span class=\"token string\">\"password\"</span> placeholder<span class=\"token operator\">=</span><span class=\"token string\">'password'</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>required<span class=\"token operator\">:</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n\r\n            <span class=\"token operator\">&lt;</span>button type<span class=\"token operator\">=</span><span class=\"token string\">\"submit\"</span> className<span class=\"token operator\">=</span><span class=\"token string\">'bg-[#7b96ec] text-white p-3 font-bold border-none cursor-pointer'</span><span class=\"token operator\">></span>Sign In<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>p className<span class=\"token operator\">=</span><span class=\"token string\">'text-[#5d5b8d] text-base mt-2'</span><span class=\"token operator\">></span>Don't you have an account<span class=\"token operator\">?</span> SignUp<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> signin</code></pre></div>\n<p>사실 이미 함수를 컨텍스트에 선언해 두었기에 바로 접근이 가능합니다.</p>\n<p>페이지 접근 제한은 _app.tsx에서 설정합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token string\">'../styles/globals.css'</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> AppProps <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/app'</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> SessionProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"next-auth/react\"</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthContextProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../context/AuthContext'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRouter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/router'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> ProtectedRoute <span class=\"token keyword\">from</span> <span class=\"token string\">'../components/ProtectedRoute'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> AuthRequired <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'/administor'</span><span class=\"token punctuation\">]</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> AppProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\r\n  <span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">useRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>AuthContextProvider<span class=\"token operator\">></span>\r\n\r\n      <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>AuthRequired<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>router<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>Component <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>pageProps<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n      <span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>ProtectedRoute<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>Component <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>pageProps<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ProtectedRoute<span class=\"token operator\">></span>\r\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n      \r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>AuthContextProvider<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> MyApp</code></pre></div>\n<p>위처럼 접근 제한 url을 설정한 뒤, 함수를 통해 현재 url이 접근 제한되는 url이라면, 따로 다른 Route 컴포넌트로 처리해주는데,</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRouter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/router'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useAuth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../context/AuthContext'</span>\r\n\r\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Props</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ProtectedRoute</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>children<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>ReactNode<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> user <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useAuth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">useRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            router<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/login'</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>router<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>user<span class=\"token operator\">?</span> children <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> ProtectedRoute</code></pre></div>\n<p>이는 위처럼 useEffect와 router를 통해서 login으로 푸쉬해 줍니다.</p>","frontmatter":{"date":"November 17, 2022","title":"Next.js Firebase 인증정보를 Context로 관리하기","categories":"WEB-DEV","author":"DEVEL","emoji":"💡"},"fields":{"slug":"/web-dev-3/"}},"prev":{"id":"ab869cab-179b-515d-bb18-07ccd0144ae9","html":"<h1 id=\"nextjs-13-버전의-대표적인-변화점\" style=\"position:relative;\"><a href=\"#nextjs-13-%EB%B2%84%EC%A0%84%EC%9D%98-%EB%8C%80%ED%91%9C%EC%A0%81%EC%9D%B8-%EB%B3%80%ED%99%94%EC%A0%90\" aria-label=\"nextjs 13 버전의 대표적인 변화점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next.js 13 버전의 대표적인 변화점</h1>\n<p>공식문서에서 설명하는 Next.js의 대표적인 변화는 다음과 같습니다.</p>\n<br />\n<hr>\n<h2 id=\"appdirectorybeta\" style=\"position:relative;\"><a href=\"#appdirectorybeta\" aria-label=\"appdirectorybeta permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>app/Directory(beta)</h2>\n<p>: 파일 기반 라우팅에서 디렉터리 기반 라우팅으로 바뀌었다는 점, app 디렉터리 안에 파일들은 기본적으로 Server Component라는 점</p>\n<br />\n<p>기존에 사용하던 파일 기반 라우팅 구조에서 app 디렉토리 하위에 디렉토리를 기반으로 하는 라우팅 구조로 바뀌었습니다.</p>\n<br />\n<p>한 디렉토리에서 테스트, 스타일, 레이아웃, 부가적인 관련 컴포넌트를 전부 함께 배치하라는 것 같습니다.</p>\n<br />\n<p>익숙해지면 나름 편리할 듯 합니다.</p>\n<br />\n<hr>\n<br />\n<p>app 디렉터리 안에서는 리액트 서버 컴포넌트를 사용합니다. 이는 React 18에 도입되는 최신 기술이며 서버에서 동작합니다.</p>\n<br />\n<p>즉, 서버에서 데이터 패칭 등 수행하고, 클라이언트에서 연속된 API 호출을 막을 수 있습니다.</p>\n<br />\n<p>그 이외에 app 디렉토리 안에 넣을 수 있는 몇 가지 지정 키워드 파일이 있습니다.</p>\n<ul>\n<li>Layout</li>\n<li>Page</li>\n<li>Loading</li>\n<li>Error</li>\n<li>Template</li>\n<li>Head</li>\n<li>Not Found</li>\n</ul>\n<br />\n<p>사용법은 간단하니 DOC 참고하시길</p>\n<br />\n<h3 id=\"그렇다면-client-component는-언제-쓰는데\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%A0%87%EB%8B%A4%EB%A9%B4-client-component%EB%8A%94-%EC%96%B8%EC%A0%9C-%EC%93%B0%EB%8A%94%EB%8D%B0\" aria-label=\"그렇다면 client component는 언제 쓰는데 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그렇다면 Client Component는 언제 쓰는데?</h3>\n<br />\n<p>친절하게 Next.js 공식문서에서 설명해 줍니다.</p>\n<br />\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 598px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 114.44444444444446%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAADKElEQVQ4y3VU2U4jMRCcB1YCbWbGbs99JUDCTSCEDVoBEhKXBIIX/v9balWdeAjs7kOr7bZdrj6D5+dnfHx84P7+Hjc3N7i7uwNtLy8veHx8xPX1NRaLBR4eHvQez2l/e3vD6+srnp6e8P7+jtPTU4RhiKCqKmxvb2M4HKKua9Vd16mm8Jx26p2dHV23bYu9vT3d8w7f53kOYwyC8XiM8/NzTKdT1fP5HBcXF5jNZjg7O1Mb9zynjXJ8fIyTk5P+nOwIpoC8cHt7i6urKxwdHellXtjd3VUQyuHhIQ4ODvSc2sv+/n5vI5i1FgEfEoC00zRFlmVKvygKJEmi4u1c+3Nq2p1ziKJIwZQhY0JQxmMymYAhoPATMiA7z4Kae2+nu3zrAZUhfyIQA+0D3DQNgiD4SxJxuJjNMBgMdJ8XBc5nM2xtbWFjYwNxHCOgGwRgFsuyVE1XNjc3e+GDHxs/kLUlLn8vcDadYhCGqKsCi1+XmiCWDJkGfOzB6D6Fn4iIxkclSeBiC9lvETYpop8DWBF0pUMqMQZhBOdk6TIBPRCZes0QUPtgmzCG7FRwXQExFsZaNJKidKmC9zFkxljIFIJ4/f2DjA9HJaTJYWOjgLVLkIvTdQ/I8hiNRiq+S3w5rJeNMwLb5rBV1gMWkiD7DrjO0Atjut5ynqHQ3foTsHT/AfTMyNIX+PeidlZguhymSiEEFIsyFmRGdN0DkgGLls1OUB8zHz8W8+V8jnbYoYkElXGICRDFMJMapit03QMyAexjDgACslyYVWoy44eMszhBKg7JWkalSCFZstyv7AHrjyzYTuwYrjlFuGb78TOyD+MIrUtRikNszZLVbr1M1HeGHKBkSNf9SGJvM37KhKzXs0qXjYW0OaTMdN0z9BNkfYqwJ9cbXqwg1rpLFVQBYwPZrvq67AEJsqzD4Zd65N5PZ+5TxtM6FL5MCDIqYVdl1LtMt1rtjg5N06KqG4hLvrSTtp+1qGStM8hwWEBWhW6lH18pinYMqSdw9Vgl6Q7h8gZ2NYXFWk3EMimJum8jA5nUWuxc94C++ZePzecw+IfYlfQ2Zf71zh8/wFwzBMwMSQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image_1.png\"\n        title=\"image_1.png\"\n        src=\"/static/35e55ec3510108c0449d903ac59302a4/0c69d/image_1.png\"\n        srcset=\"/static/35e55ec3510108c0449d903ac59302a4/e9ff0/image_1.png 180w,\n/static/35e55ec3510108c0449d903ac59302a4/f21e7/image_1.png 360w,\n/static/35e55ec3510108c0449d903ac59302a4/0c69d/image_1.png 598w\"\n        sizes=\"(max-width: 598px) 100vw, 598px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br />\n<p>우리가 기존에 Server 컴포넌트를 사용했던 이유는 보안 키 같은 중요한 요소들이 노출될 위험성도 감추고, 사용자 경험도 증가시켜준다는 점 등 이었습니다..</p>\n<br />\n<p>그렇다면 Client 컴포넌트는 언제 사용하냐?</p>\n<br />\n<p>위 사진 처럼</p>\n<br />\n<ul>\n<li>\n<p>eventListeners(onClick이나 onChange같은 것들)를 사용하는 때</p>\n</li>\n<li>\n<p>Lifecycle Effects, 즉 브라우저에서 구동되는 useState(), useEffect() 같은 것들을 사용하거나 이를 기반으로 한 custom hook을 사용하는 경우</p>\n</li>\n</ul>\n<br />\n<p>와 같이 주로 상태값을 요구로 하거나, 브라우저에서 처리할 요소들이 온다면 Client Component를 사용하는 듯 합니다.</p>\n<br />\n<p>app 디렉터리에서 Client 컴포넌트를 사용하는 법은 간단합니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use client'</span>\r\n\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRouter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/navigation'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> FormEvent<span class=\"token punctuation\">,</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">Search</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span><span class=\"token constant\">I</span> am a Search component<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Search<span class=\"token punctuation\">;</span></code></pre></div>\n<p>‘use client’ 문자열을 코드 맨 위에 붙이면 됩니다.</p>\n<br />\n<hr>\n<br />\n<h2 id=\"data-fetching\" style=\"position:relative;\"><a href=\"#data-fetching\" aria-label=\"data fetching permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data Fetching</h2>\n<br />\n<p>데이터 패칭의 방법도 변화했습니다.</p>\n<br />\n<p>기존에 next.js에서 데이터 패칭을 위해 사용했던 SSR, SSG, ISR이 있고, getStaticProps / getServerSideProps 와 revalidate를 통해서 이 세개를 구현했었는데…</p>\n<br />\n<p>사실 캐싱된 데이터를 얼마나 가지고 있느냐의 차이일 뿐 거창하게 함수 이것 저것 써가면서 코드를 짰습니다.</p>\n<br />\n<p>이번에 13버전에서 바뀐 점은 이제 쉽게 SSR, SSG, ISR의 개념을 쉽게 적용할 수 있습니다.</p>\n<br />\n<p>첫 번째는 use hook을 사용하는 겁니다.</p>\n<br />\n<p>이전에는 getStaticProps 같은 지정 함수를 통해서 데이터를 fetch하고 이를 props로 전달해 컴포넌트의 인자로 다시 전달 받고 타입스크립트라면 타입도 체크해 주어야 하는 기나긴 과정을 거쳐야 했습니다.</p>\n<br />\n<p>하지만! 이제는 React에서 제공하는 use hook을 사용하면 됩니다.</p>\n<br />\n<p>이는 React에서 최근에 공개한 데이터를 가져오는 새로운 방법을 제공하는 기능입니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> use <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Page</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// use Hook을 이용해 제공</span>\r\n  <span class=\"token keyword\">const</span> name <span class=\"token operator\">=</span> <span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Hello World<span class=\"token operator\">!</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"API 주소\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br />\n<p>위처럼 쉽게 데이터를 fetch받는 함수를 React 컴포넌트 안에 넣을 수 있습니다.</p>\n<br />\n<p>또한 SSR, SSG, ISR의 기능은 fetch API를 통해 구현할 수 있습니다.</p>\n<br />\n<p>SSR</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>\r\n        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://jsonplaceholder.typicode.com/todos/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>todoid<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">cache</span><span class=\"token operator\">:</span> <span class=\"token string\">\"no-cache\"</span> <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">)</span></code></pre></div>\n<br />\n<p>SSG</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>\r\n        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://jsonplaceholder.typicode.com/todos/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>todoid<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">cache</span><span class=\"token operator\">:</span> <span class=\"token string\">\"no-cache\"</span> <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">)</span></code></pre></div>\n<br />\n<p>ISR</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>\r\n        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://jsonplaceholder.typicode.com/todos/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>todoid<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">next</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">revalidate</span><span class=\"token operator\">:</span> <span class=\"token number\">60</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">)</span></code></pre></div>\n<br />\n<h2 id=\"turbopack\" style=\"position:relative;\"><a href=\"#turbopack\" aria-label=\"turbopack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Turbopack</h2>\n<br />\n<p>웹 개발을 위해서는 Rust 기반의 JS 번들링 툴이 필요하답니다. 이는 기존의 웹팩보다 700배 빠르고 Vite보다 10배 빠르게 Javascript를 컴파일 해주는 번들링 툴입니다.</p>\n<br />\n<p>하지만 안정화 된 후에 사용하는 것이 좋다고 합니다.</p>\n<br />\n<h2 id=\"nextimage와-nextfont의-layout-shift-방지\" style=\"position:relative;\"><a href=\"#nextimage%EC%99%80-nextfont%EC%9D%98-layout-shift-%EB%B0%A9%EC%A7%80\" aria-label=\"nextimage와 nextfont의 layout shift 방지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>next/Image와 next/font의 Layout Shift 방지</h2>\n<br />\n<p>이미지나 폰트의 로드가 느릴 경우 기존의 레이아웃이 밀리는 Layout Shift 현상이 발생할 수 있는데, next/Image는 이를 자동으로 처리해주고, 폰트도 지원해 줍니다.</p>\n<br />\n<p>또한 폰트는 구글 폰트가 기본적으로 내장됩니다.</p>\n<br />\n<h2 id=\"nextlink의-변화\" style=\"position:relative;\"><a href=\"#nextlink%EC%9D%98-%EB%B3%80%ED%99%94\" aria-label=\"nextlink의 변화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>next/Link의 변화</h2>\n<br />\n<p>이전에는 a태그를 Link태그 안에 넣어서 사용했어야 했는데, 이제는 Link만 넣어도 됩니다.</p>\n<br />\n<h2 id=\"og-image\" style=\"position:relative;\"><a href=\"#og-image\" aria-label=\"og image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OG Image</h2>\n<br />\n<p>링크를 첨부할 때 같이 연관된 이미지가 뜨는 것을 OG Image 라고 합니다.</p>\n<br />\n<p>기존에 시간이 오래 걸리고 오류가 발생하기 쉬웠던 어려움을 개선하기 위해 동적 소셜 카드를 새롭게 생성하는 라이브러리 @vercel/og를 도입하였습니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// pages/api/og.jsx</span>\r\n\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ImageResponse <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@vercel/og'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">runtime</span><span class=\"token operator\">:</span> <span class=\"token string\">'experimental-edge'</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ImageResponse</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token punctuation\">(</span>\r\n      <span class=\"token operator\">&lt;</span>div\r\n        style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n          <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token literal-property property\">fontSize</span><span class=\"token operator\">:</span> <span class=\"token number\">128</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token string\">'white'</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n      <span class=\"token operator\">></span>\r\n        Hello<span class=\"token punctuation\">,</span> World<span class=\"token operator\">!</span>\r\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br />\n<h2 id=\"미들웨어-api-업데이트\" style=\"position:relative;\"><a href=\"#%EB%AF%B8%EB%93%A4%EC%9B%A8%EC%96%B4-api-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8\" aria-label=\"미들웨어 api 업데이트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>미들웨어 API 업데이트</h2>\n<br />\n<p>기존에 next.js 12에서 추가되었던 Middleware 기능이 개선되었습니다.</p>\n<br />\n<p>Request Header 값을 쉽게 세팅할 수 있습니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// middleware.ts</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NextResponse <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/server'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> type <span class=\"token punctuation\">{</span> NextRequest <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/server'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">middleware</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">request</span><span class=\"token operator\">:</span> NextRequest</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// 기존 헤더를 복사한 후 새로운 헤더를 셋팅</span>\r\n  <span class=\"token keyword\">const</span> requestHeaders <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Headers</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  requestHeaders<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'x-version'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'13'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// NextResponse.rewrite에서도 직접 Reqeust header를 설정할 수 있습니다.</span>\r\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> NextResponse<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">request</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token comment\">// New request headers</span>\r\n      <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> requestHeaders<span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Set a new response header `x-version`</span>\r\n  response<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'x-version'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'13'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br />\n<p>그리고 redirect 기능을 사용할 때, rewrite, redirect 기능을 사용하지 않고 json형태로 처리할 수 있습니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// middleware.ts</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NextRequest<span class=\"token punctuation\">,</span> NextResponse <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/server'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> isAuthenticated <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@lib/auth'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Limit the middleware to paths starting with `/api/`</span>\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">matcher</span><span class=\"token operator\">:</span> <span class=\"token string\">'/api/:function*'</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">middleware</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">request</span><span class=\"token operator\">:</span> NextRequest</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// Call our authentication function to check the request</span>\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isAuthenticated</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// 인증을 실패할 경우 오류 메시지를 json 형태로 담아 Response 처리</span>\r\n    <span class=\"token keyword\">return</span> NextResponse<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>\r\n      <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">success</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">message</span><span class=\"token operator\">:</span> <span class=\"token string\">'Auth failed'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token number\">401</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br />\n<p>하지만 지금은 이 기능을 사용하기 위해 next.config.js에서 부가 설정을 해주어야 합니다.</p>\n<br />\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> nextConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">reactStrictMode</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">swcMinify</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token comment\">// option 추가</span>\r\n  <span class=\"token literal-property property\">experimental</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">allowMiddlewareResponseBody</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> nextConfig<span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<hr>\n<br />\n<h2 id=\"-references\" style=\"position:relative;\"><a href=\"#-references\" aria-label=\" references permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👏 References</h2>\n<br />\n<ul>\n<li>\n<p><a href=\"https://velog.io/@woodong/Next.js-13-%EC%86%8C%EA%B0%9C#6-og-image-generation\">https://velog.io/@woodong/Next.js-13-%EC%86%8C%EA%B0%9C#6-og-image-generation</a></p>\n</li>\n<li>\n<p><a href=\"https://velog.io/@hang_kem_0531/Next.js-13%EC%9D%B4-%EB%82%98%EC%99%80%EB%B2%84%EB%A0%B8%EB%8B%A4#data-fetching\">https://velog.io/@hang_kem_0531/Next.js-13%EC%9D%B4-%EB%82%98%EC%99%80%EB%B2%84%EB%A0%B8%EB%8B%A4#data-fetching</a></p>\n</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#appdirectorybeta\">app/Directory(beta)</a></p>\n<ul>\n<li><a href=\"#%EA%B7%B8%EB%A0%87%EB%8B%A4%EB%A9%B4-client-component%EB%8A%94-%EC%96%B8%EC%A0%9C-%EC%93%B0%EB%8A%94%EB%8D%B0\">그렇다면 Client Component는 언제 쓰는데?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#data-fetching\">Data Fetching</a></p>\n</li>\n<li>\n<p><a href=\"#turbopack\">Turbopack</a></p>\n</li>\n<li>\n<p><a href=\"#nextimage%EC%99%80-nextfont%EC%9D%98-layout-shift-%EB%B0%A9%EC%A7%80\">next/Image와 next/font의 Layout Shift 방지</a></p>\n</li>\n<li>\n<p><a href=\"#nextlink%EC%9D%98-%EB%B3%80%ED%99%94\">next/Link의 변화</a></p>\n</li>\n<li>\n<p><a href=\"#og-image\">OG Image</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%AF%B8%EB%93%A4%EC%9B%A8%EC%96%B4-api-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8\">미들웨어 API 업데이트</a></p>\n</li>\n<li>\n<p><a href=\"#-references\">👏 References</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 09, 2022","title":"Next.js 13 버전 가볍게 정리","categories":"WEB-DEV","author":"DEVEL","emoji":"🦊"},"fields":{"slug":"/web-dev-4/"}},"site":{"siteMetadata":{"siteUrl":"https://hsjni0110.github.io/devel-repo","comments":{"utterances":{"repo":"hsjni0110/hsjni0110.github.io"}}}}},"pageContext":{"slug":"/web-dev-2/","nextSlug":"/web-dev-3/","prevSlug":"/web-dev-4/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}